# Complete Guide: Mount S3 as Drive on Windows (WinFsp + Rclone)

## Method 1: Manual Installation (Recommended for Beginners)

### Step 1: Install WinFsp
1. **Download WinFsp:**
   - Go to: https://winfsp.dev/rel/
   - Download the latest `winfsp-x.x.xxxxx.msi` file (usually around 2-3 MB)
   - Choose the stable release version

2. **Install WinFsp:**
   - Double-click the downloaded `.msi` file
   - Run as Administrator if prompted
   - Follow the installation wizard (click Next â†’ Next â†’ Install)
   - **Important:** Keep all default settings
   - Restart your computer after installation

### Step 2: Install Rclone
1. **Download Rclone:**
   - Go to: https://rclone.org/downloads/
   - Download "Microsoft Windows" version (Intel/AMD - 64 Bit)
   - You'll get a zip file like `rclone-v1.xx.x-windows-amd64.zip`

2. **Extract and Install Rclone:**
   - Extract the zip file to `C:\rclone\` (create this folder)
   - You should have: `C:\rclone\rclone.exe`

3. **Add Rclone to System PATH:**
   - Press `Win + R`, type `sysdm.cpl`, press Enter
   - Click "Environment Variables" button
   - Under "System Variables", find and select "Path"
   - Click "Edit" â†’ "New"
   - Add: `C:\rclone`
   - Click OK on all windows
   - **Restart Command Prompt** for changes to take effect

### Step 3: Configure Rclone for S3
1. **Open Command Prompt as Administrator:**
   - Press `Win + X`, select "Command Prompt (Admin)" or "PowerShell (Admin)"

2. **Start Rclone Configuration:**
   ```cmd
   rclone config
   ```

3. **Create New Remote:**
   - Type `n` for "New remote"
   - Enter name: `s3drive` (or any name you prefer)
   - Choose number for "Amazon S3 Compliant Storage Providers" (usually option 5)

4. **Select S3 Provider:**
   - Choose `1` for "Amazon Web Services (AWS) S3"

5. **Enter AWS Credentials:**
   - **Access Key ID:** Enter your AWS Access Key
   - **Secret Access Key:** Enter your AWS Secret Key
   - **Region:** Enter your S3 bucket region (e.g., `us-east-1`, `ap-south-1`)
   - **Endpoint:** Leave blank (press Enter)
   - **Location constraint:** Enter same as region or leave blank
   - **ACL:** Choose `private` (option 1)

6. **Advanced Configuration:**
   - For all other options, press Enter to use defaults
   - When asked "Edit advanced config?", type `n`

7. **Confirm Configuration:**
   - Type `y` to confirm
   - Type `q` to quit configuration

### Step 4: Test the Setup
1. **List your S3 buckets:**
   ```cmd
   rclone lsd s3drive:
   ```
   You should see your S3 buckets listed.

2. **Test mounting (temporary):**
   ```cmd
   rclone mount s3drive:your-bucket-name Z: --vfs-cache-mode writes
   ```
   - Replace `your-bucket-name` with actual bucket name
   - Replace `Z:` with preferred drive letter

3. **Check Windows Explorer:**
   - Open File Explorer
   - You should see drive Z: with your S3 bucket contents
   - **Test drag and drop** by copying a small file

4. **Unmount the drive:**
   - Press `Ctrl + C` in the command prompt
   - The drive will disappear from Explorer

---

## Method 2: Using Chocolatey (Advanced Users)

### Step 1: Install Chocolatey
1. **Open PowerShell as Administrator**

2. **Install Chocolatey:**
   ```powershell
   Set-ExecutionPolicy Bypass -Scope Process -Force; [System.Net.ServicePointManager]::SecurityProtocol = [System.Net.ServicePointManager]::SecurityProtocol -bor 3072; iex ((New-Object System.Net.WebClient).DownloadString('https://community.chocolatey.org/install.ps1'))
   ```

3. **Restart PowerShell as Administrator**

### Step 2: Install WinFsp and Rclone via Chocolatey
```powershell
choco install winfsp rclone -y
```

### Step 3: Configure Rclone
Follow the same configuration steps from Method 1, Step 3.

---

## Creating Permanent Mount Scripts

### Option 1: Batch File for Easy Mounting
1. **Create Mount Script:**
   - Create file: `C:\rclone\mount-s3.bat`
   - Add content:
   ```batch
   @echo off
   echo Mounting S3 bucket as drive Z:
   rclone mount s3drive:your-bucket-name Z: --vfs-cache-mode writes --vfs-cache-max-age 1h
   pause
   ```

2. **Create Unmount Script:**
   - Create file: `C:\rclone\unmount-s3.bat`
   - Add content:
   ```batch
   @echo off
   echo Unmounting drive Z:
   taskkill /f /im rclone.exe
   echo Drive unmounted
   pause
   ```

### Option 2: Windows Service (Background Mounting)
1. **Install NSSM (Non-Sucking Service Manager):**
   - Download from: https://nssm.cc/download
   - Extract to `C:\nssm\`

2. **Create Service:**
   ```cmd
   C:\nssm\nssm.exe install "RcloneS3Mount"
   ```

3. **Configure Service:**
   - **Path:** `C:\rclone\rclone.exe`
   - **Arguments:** `mount s3drive:your-bucket-name Z: --vfs-cache-mode writes`
   - **Startup directory:** `C:\rclone\`

4. **Start Service:**
   ```cmd
   net start RcloneS3Mount
   ```

---

## Recommended Settings for Best Performance

### Optimized Mount Command:
```cmd
rclone mount s3drive:your-bucket-name Z: ^
  --vfs-cache-mode writes ^
  --vfs-cache-max-age 1h ^
  --vfs-cache-max-size 1G ^
  --vfs-read-chunk-size 32M ^
  --vfs-read-chunk-size-limit 1G ^
  --buffer-size 32M
```

**What these options do:**
- `--vfs-cache-mode writes`: Caches written files locally
- `--vfs-cache-max-age 1h`: Cache files for 1 hour
- `--vfs-cache-max-size 1G`: Use max 1GB for cache
- `--vfs-read-chunk-size 32M`: Read in 32MB chunks
- `--buffer-size 32M`: Use 32MB buffer

---

## Troubleshooting Common Issues

### Issue 1: "WinFsp not found"
**Solution:** Reinstall WinFsp and restart computer

### Issue 2: "Access denied" when mounting
**Solution:** Run Command Prompt as Administrator

### Issue 3: Drive appears but files don't load
**Solution:** Check your AWS credentials and S3 bucket permissions

### Issue 4: Slow performance
**Solution:** Use the optimized mount command with caching options

### Issue 5: Mount disconnects randomly
**Solution:** Add `--vfs-cache-mode full` for better stability

---

## Security Best Practices

1. **Create IAM User:** Don't use root AWS credentials
2. **Minimal Permissions:** Grant only S3 access to specific buckets
3. **Credential Storage:** Store AWS credentials securely
4. **Network Security:** Use HTTPS endpoints only

---

## Usage Tips

1. **Multiple Buckets:** Create separate remotes for different buckets
2. **Folder Mounting:** Mount specific folders: `s3drive:bucket/folder`
3. **Read-Only Access:** Add `--read-only` flag for safety
4. **Logging:** Add `--log-file C:\rclone\mount.log` for debugging

---

## Your S3 bucket is now mounted as a Windows drive! ðŸŽ‰

You can now:
- âœ… Drag and drop files in Windows Explorer
- âœ… Open files directly from the mounted drive
- âœ… Use any Windows application with S3 files
- âœ… Copy/paste files like a normal drive
- âœ… Access from command line as drive Z: